<!doctype html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="Find and select your Black Squirrel Cafe location" />
    <meta
      name="author"
      content="Black Squirrel Cafe Team"
    />
    <meta name="generator" content="Astro v5.13.2" />
    <title>Store Locations - The Black Squirrel Cafe</title>
    <link
      rel="canonical"
      href="https://getbootstrap.com/docs/5.3/examples/carousel/"
    />
    <link href="../assets/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../assets/css/black-squirrel-theme.css" rel="stylesheet" />
    <meta name="theme-color" content="#712cf9" />
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
  </head>
  <body>

    <!-- HEADER -->
    <header>
      <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <div class="container-fluid">
          <a class="navbar-brand">The Black Squirrel Cafe | </a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarCollapse"
            aria-controls="navbarCollapse"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav me-auto mb-2 mb-md-0">
              <li class="nav-item">
                <a class="nav-link" href="../index.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="../menu/menu.html">Menu</a>
              </li>
                <a class="nav-link" href="../checkout/checkout.html">Checkout</a>
              <li class="nav-item">
                <a class="nav-link" href="../rewards/rewards.html">Promotions</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="../events/events.html">Events</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="../about/about.html">About Us</a>
              </li>
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="#">Location</a>
              </li>
            </ul>
            <svg class="navbar-icon ms-auto" version="1.0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024.000000 1024.000000" preserveAspectRatio="xMidYMid meet" fill="#FCFCFA">
              <g transform="translate(0.000000,1024.000000) scale(0.100000,-0.100000)">
                <path d="M5885 7604 c-252 -45 -442 -136 -606 -291 -128 -121 -233 -293 -281 -458 -20 -71 -23 -102 -22 -265 0 -180 1 -187 31 -277 46 -138 120 -262 293 -491 192 -255 231 -316 329 -512 106 -215 173 -424 206 -651 21 -138 16 -439 -9 -559 -19 -93 -57 -226 -91 -316 -103 -274 -352 -565 -582 -683 -48 -24 -49 -21 -29 37 8 22 22 101 32 174 35 274 -3 524 -117 765 -89 187 -254 392 -401 496 -82 59 -210 119 -303 143 -101 26 -294 24 -396 -4 -235 -63 -401 -229 -465 -462 -27 -97 -24 -326 5 -435 26 -96 75 -204 137 -297 84 -126 325 -362 467 -456 37 -25 67 -49 67 -53 0 -5 -187 -9 -415 -9 -393 0 -417 -1 -469 -20 -105 -40 -178 -140 -180 -245 l-1 -60 425 -5 425 -5 115 -42 c454 -165 973 -197 1411 -87 670 167 1188 632 1435 1287 49 129 83 261 111 425 25 148 25 522 0 667 -63 360 -201 701 -457 1125 -201 333 -241 476 -190 674 26 103 63 168 135 241 143 143 363 199 575 146 41 -11 76 -18 78 -16 9 8 -128 150 -207 215 -258 212 -555 321 -866 319 -60 0 -146 -7 -190 -15z"/>
                <path d="M4590 7469 c-249 -65 -468 -262 -561 -505 l-24 -62 -63 -6 c-324 -34 -584 -187 -751 -446 -34 -52 -109 -189 -168 -304 l-105 -209 86 -83 c47 -46 107 -94 133 -107 320 -161 730 -38 936 280 24 38 60 102 79 143 61 126 138 146 200 53 25 -39 22 -95 -11 -191 -105 -302 -386 -557 -711 -647 -85 -24 -120 -28 -340 -35 -279 -8 -305 -15 -383 -93 -51 -51 -77 -116 -77 -194 l0 -53 226 0 c202 0 233 -2 296 -21 61 -19 86 -21 197 -16 69 3 180 15 246 27 242 44 486 36 674 -22 275 -85 534 -292 715 -571 80 -122 131 -236 191 -422 l52 -160 21 41 c11 22 32 81 46 130 78 272 83 555 16 819 -89 354 -243 615 -600 1020 -191 218 -253 303 -325 450 -77 157 -106 269 -113 436 -8 201 43 427 126 567 39 65 55 84 131 165 l35 37 -49 -1 c-28 0 -84 -9 -125 -20z m-710 -994 c0 -109 -62 -216 -156 -267 -64 -34 -158 -52 -229 -43 l-55 6 6 42 c19 135 80 234 177 283 52 27 77 32 170 33 l87 1 0 -55z"/>
              </g>
            </svg>
          </div>
        </div>
      </nav>
    </header>

    <main>
      <div class="container marketing" style="padding-top: 80px;">
        <!-- Page Header -->
        <p class="lead mb-5"></p></p>
        <div class="row justify-content-center">
          <div class="col-lg-8 text-center">
            <h1 class="display-4 fw-bold mb-4">Find Your Black Squirrel Cafe</h1>
            <p class="lead mb-5">Search for nearby locations and choose how you'd like to order</p>
          </div>
        </div>
        <hr class="featurette-divider" />
        
        
        
        <!-- Search Section -->
        <p class="lead mb-5"></p></p>
        <div class="row mb-4">
          <div class="col-md-8 mx-auto">
            <div class="input-group">
              <input 
                type="text" 
                class="form-control form-control-lg" 
                placeholder="Search by city, area, or address (e.g., 'Kent', 'Main', 'Library')" 
                id="locationSearch"
                aria-label="Location search"
              >
              <button class="btn btn-primary btn-lg" type="button" onclick="searchLocations()">
                Search
              </button>
              <button class="btn btn-outline-secondary btn-lg" type="button" onclick="showAllLocations()">
                Show All
              </button>
            </div>
            <div class="text-center mt-2">
              <small class="text-muted">Try: "Kent", "Main", "Library"</small>
            </div>
          </div>
        </div>
        
        <!-- Map and Results Section -->
        <div class="row">
          <!-- Map Column -->
          <div class="col-lg-8 mb-4">
            <div id="map"></div>
          </div>
          
          <!-- Location List Column --> 
          <div class="col-lg-4">
            <div id="locationsList">
              <div id="noResults" class="text-center text-muted">
                <p>Enter a location to find nearby Black Squirrel Cafe stores</p>
              </div>
              
              <!-- Sample locations (will be populated by search) -->
              <div id="searchResults" style="display: none;">
                <h5 class="mb-3">Nearby Locations</h5>
                
                <div class="location-card interactive-card" data-location="1" onclick="selectLocation(1)">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <h6 class="mb-1">Black Squirrel Cafe Downtown</h6>
                      <p class="mb-1 text-muted small">150 E Main St<br>Kent, OH 44240</p>
                      <p class="mb-0 small"><strong>Wait Time:</strong> <span class="text-warning">8 minutes</span></p>
                    </div>
                    <div class="text-end">
                      <small class="text-muted">0.5 miles</small>
                    </div>
                  </div>
                </div>
                
                <div class="location-card interactive-card" data-location="2" onclick="selectLocation(2)">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <h6 class="mb-1">Black Squirrel Cafe University</h6>
                      <p class="mb-1 text-muted small">801 E Summit St<br>Kent, OH 44240</p>
                      <p class="mb-0 small"><strong>Wait Time:</strong> <span class="text-success">3 minutes</span></p>
                    </div>
                    <div class="text-end">
                      <small class="text-muted">1.2 miles</small>
                    </div>
                  </div>
                </div>
                
                <div class="location-card interactive-card" data-location="3" onclick="selectLocation(3)">
                  <div class="d-flex justify-content-between align-items-start">
                    <div>
                      <h6 class="mb-1">Black Squirrel Cafe Stow</h6>
                      <p class="mb-1 text-muted small">4301 Kent Rd<br>Stow, OH 44224</p>
                      <p class="mb-0 small"><strong>Wait Time:</strong> <span class="text-success">2 minutes</span></p>
                    </div>
                    <div class="text-end">
                      <small class="text-muted">2.1 miles</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Location Confirmation Section -->
      <p class="lead mb-5"></p></p>
      <div id="locationConfirmation" class="container mt-5" style="display: none;">
        <div class="row justify-content-center">
          <div class="col-lg-8">
            <div class="location-info">
              <div class="row">
                <div class="col-md-8">
                  <h4 id="selectedLocationName">Black Squirrel Cafe Downtown</h4>
                  <p id="selectedLocationAddress" class="text-muted mb-3">150 E Main St, Kent, OH 44240</p>
                  
                  <!-- Warnings Section -->
                  <div id="warningsSection">
                    <!-- Dynamic warnings will be inserted here -->
                  </div>
                  
                  <div class="mb-3">
                    <p class="mb-1"><strong>Estimated Wait Time:</strong> <span id="selectedWaitTime">8 minutes</span></p>
                    <p class="mb-0"><strong>Distance:</strong> <span id="selectedDistance">0.5 miles</span></p>
                  </div>
                </div>
                <div class="col-md-4 text-end">
                  <button class="btn btn-outline-primary btn-sm mb-2" onclick="getDirections()">
                    Get Directions
                  </button>
                  <button class="btn btn-outline-secondary btn-sm mb-2" onclick="changeLocation()">
                    Change Location
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Service Selection -->
            <div class="mt-4">
              <h5 class="mb-3 text-center">How would you like to order?</h5>
              <div class="row justify-content-center">
                <div class="col-md-4">
                  <div class="service-option interactive-card" data-service="drive-thru" onclick="selectService('drive-thru')">
                    <h6>Drive Thru</h6>
                    <p class="small text-muted mb-0">Stay in your car</p>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="service-option interactive-card" data-service="pickup" onclick="selectService('pickup')">
                    <h6>Pick-up</h6>
                    <p class="small text-muted mb-0">Order ahead, pick up fast</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Confirmation Button -->
            <div class="text-center mt-4">
              <button 
                id="confirmLocationBtn" 
                class="btn btn-primary btn-lg px-5" 
                onclick="confirmLocation()"
              >
                Confirm Location & Continue
              </button>
            </div>
          </div>
        </div>
      </div>
      <p class="lead mb-5"></p></p>
      
      <!-- Confirmation Modal -->
      <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="confirmationModalLabel">Order Confirmed!</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="text-center">
                <h6>Location & Service Confirmed</h6>
                <p class="mb-1"><strong>Location:</strong> <span id="modalLocationName"></span></p>
                <p class="mb-1"><strong>Service:</strong> <span id="modalServiceType"></span></p>
                <p class="mb-3"><strong>Estimated Time:</strong> <span id="modalWaitTime"></span></p>
                <p class="text-muted">You can now proceed to browse our menu and place your order.</p>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Back to Locations</button>
              <button type="button" class="btn btn-primary" onclick="proceedToMenu()">Browse Menu</button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="container">
        <hr class="featurette-divider" />
      </div>
      
    </main>
    
      <!-- FOOTER -->
      <footer class="text-light mt-5 pt-4 pb-3">
        <div class="container">
          <p class="float-end"><a href="#" class="text-light">Back to top</a></p>
          <p>&copy; 2025 Black Squirrel Coffee</p>
        </div>
      </footer>    

    <!-- Scripts -->
    <script src="../assets/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
    
    <script>
      /* ==========================================
         LOCATION FINDER - JAVASCRIPT
         ========================================== */
      
      // Location data with real coordinates around Kent, Ohio
      const locations = {
        1: {
          name: "Black Squirrel Cafe Library",
          address: "1125 Risman Dr, Kent, OH 44242",
          lat: 41.14646645315748,
          lng: -81.34222884363092,
          waitTime: "8 minutes",
          waitTimeValue: 8,
          outOfStock: ["Espresso Blend"],
          otherWarnings: []
        },
        2: {
          name: "Black Squirrel Cafe Main Street",
          address: "1005 E Main St, Kent, OH 44240", 
          lat: 41.15414038096881,
          lng: -81.34472058073035,
          waitTime: "3 minutes",
          waitTimeValue: 3,
          outOfStock: [],
          otherWarnings: []
        },
        3: {
          name: "Black Squirrel Cafe Acorn Alley",
          address: "164 E Main St #203, Kent, OH 44240",
          lat: 41.15346045092544,
          lng: -81.35691026999143,
          waitTime: "2 minutes",
          waitTimeValue: 2,
          outOfStock: [],
          otherWarnings: ["Limited seating available"]
        }
      };
      
      // Kent, Ohio coordinates (user's default location)
      const userLocation = {
        lat: 41.14477475842464,
        lng: -81.34139666280572
      };
      
      // Map variables
      let map;
      let userMarker;
      let cafeMarkers = {};
      let selectedMarker = null;
      
      let selectedLocationId = null;
      let selectedService = null;
      
      // Initialize map when page loads
      document.addEventListener('DOMContentLoaded', function() {
        initializeMap();
      });
      
      // Initialize the map
      function initializeMap() {
        // Create map centered on Kent, Ohio
        map = L.map('map').setView([userLocation.lat, userLocation.lng], 13);
        
        // Add simplified map tiles (CartoDB Positron)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
          maxZoom: 19,
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
          subdomains: 'abcd'
        }).addTo(map);
        
        // Add user location marker
        const userIcon = L.divIcon({
          className: 'user-marker',
          html: 'ðŸ“',
          iconSize: [25, 25],
          iconAnchor: [12, 12]
        });
        
        userMarker = L.marker([userLocation.lat, userLocation.lng], {icon: userIcon})
          .addTo(map)
          .bindPopup('Your Location (Kent, OH)')
          .openPopup();
        
        // Close popup after 2 seconds
        setTimeout(() => {
          userMarker.closePopup();
        }, 2000);
        
        // Add cafe markers
        Object.keys(locations).forEach(locationId => {
          addCafeMarker(locationId, locations[locationId]);
        });
      }
      
      // Add a cafe marker to the map
      function addCafeMarker(locationId, location) {
        const cafeIcon = L.divIcon({
          className: 'cafe-marker',
          html: 'â˜•',
          iconSize: [30, 30],
          iconAnchor: [15, 15]
        });
        
        const marker = L.marker([location.lat, location.lng], {icon: cafeIcon})
          .addTo(map)
          .bindPopup(`
            <div class="text-center">
              <strong>${location.name}</strong><br>
              <small>${location.address}</small><br>
              <small>Wait Time: ${location.waitTime}</small><br>
              <button class="btn btn-primary btn-sm mt-1" onclick="selectLocationFromPopup(${locationId})">
                Select This Location
              </button>
            </div>
          `);
        
        // Store the original brown color icon
        marker.originalIcon = cafeIcon;
        
        // Create blue selected icon
        const selectedIcon = L.divIcon({
          className: 'cafe-marker',
          html: 'â˜•',
          iconSize: [30, 30],
          iconAnchor: [15, 15],
          style: 'background-color: #0d6efd;'
        });
        marker.selectedIcon = selectedIcon;
        
        cafeMarkers[locationId] = marker;
      }
      
      // Function to handle selection from popup (needed for onclick in HTML string)
      function selectLocationFromPopup(locationId) {
        selectLocation(locationId);
        // Close the popup after selection
        if (cafeMarkers[locationId]) {
          cafeMarkers[locationId].closePopup();
        }
      }
      
      // Calculate distance between two coordinates (Haversine formula)
      function calculateDistance(lat1, lng1, lat2, lng2) {
        const R = 3959; // Earth's radius in miles
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLng = (lng2 - lng1) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                  Math.sin(dLng/2) * Math.sin(dLng/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        const distance = R * c;
        return Math.round(distance * 10) / 10; // Round to 1 decimal place
      }
      
      // Update location distances based on user location
      function updateDistances() {
        Object.keys(locations).forEach(locationId => {
          const location = locations[locationId];
          const distance = calculateDistance(
            userLocation.lat, userLocation.lng,
            location.lat, location.lng
          );
          location.distance = distance + ' miles';
        });
      }
      
      // Search for locations
      function searchLocations() {
        const searchInput = document.getElementById('locationSearch');
        const searchValue = searchInput.value.trim().toLowerCase();
        
        if (searchValue === '') {
          alert('Please enter a location to search');
          return;
        }
        
        // Filter locations based on search input
        const filteredLocations = filterLocationsBySearch(searchValue);
        
        if (filteredLocations.length === 0) {
          // No matches found
          document.getElementById('searchResults').style.display = 'none';
          document.getElementById('noResults').innerHTML = `
            <div class="text-center text-muted">
              <p>No locations found for "${searchValue}"</p>
              <p class="small">Try searching for "Kent", "Main", or "Library""</p>
            </div>
          `;
          document.getElementById('noResults').style.display = 'block';
          return;
        }
        
        // Update distances from user location
        updateDistances();
        
        // Show filtered search results
        document.getElementById('noResults').style.display = 'none';
        document.getElementById('searchResults').style.display = 'block';
        
        // Update location cards to show only filtered results
        displayFilteredResults(filteredLocations, searchValue);
        
        // Show only matching markers on map
        showFilteredMarkersOnMap(filteredLocations);
      }
      
      // Filter locations based on search criteria
      function filterLocationsBySearch(searchValue) {
        const filtered = [];
        
        Object.keys(locations).forEach(locationId => {
          const location = locations[locationId];
          
          // Check if search matches name, address, or city
          const nameMatch = location.name.toLowerCase().includes(searchValue);
          const addressMatch = location.address.toLowerCase().includes(searchValue);
          
          // Check for specific keywords
          const keywordMatches = (
            (searchValue.includes('downtown') && location.name.toLowerCase().includes('downtown')) ||
            (searchValue.includes('university') && location.name.toLowerCase().includes('university')) ||
            (searchValue.includes('stow') && location.address.toLowerCase().includes('stow')) ||
            (searchValue.includes('kent') && location.address.toLowerCase().includes('kent')) ||
            (searchValue.includes('main') && location.address.toLowerCase().includes('main')) ||
            (searchValue.includes('summit') && location.address.toLowerCase().includes('summit'))
          );
          
          if (nameMatch || addressMatch || keywordMatches) {
            filtered.push({
              id: locationId,
              ...location
            });
          }
        });
        
        return filtered;
      }
      
      // Display filtered results in the location list
      function displayFilteredResults(filteredLocations, searchValue) {
        const resultsContainer = document.getElementById('searchResults');
        
        resultsContainer.innerHTML = `
          <h5 class="mb-3">Search Results for "${searchValue}" (${filteredLocations.length})</h5>
        `;
        
        filteredLocations.forEach(location => {
          const locationCard = document.createElement('div');
          locationCard.className = 'location-card interactive-card';
          locationCard.setAttribute('data-location', location.id);
          locationCard.setAttribute('onclick', `selectLocation(${location.id})`);
          
          let waitTimeClass = 'status-good';
          if (location.waitTimeValue > 5) waitTimeClass = 'status-warning';
          
          locationCard.innerHTML = `
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h6 class="mb-1">${location.name}</h6>
                <p class="mb-1 text-muted small">${location.address.replace(', ', '<br>')}</p>
                <p class="mb-0 small"><strong>Wait Time:</strong> <span class="${waitTimeClass}">${location.waitTime}</span></p>
              </div>
              <div class="text-end">
                <small class="text-muted">${location.distance}</small>
              </div>
            </div>
          `;
          
          resultsContainer.appendChild(locationCard);
        });
      }
      
      // Show only filtered markers on the map
      function showFilteredMarkersOnMap(filteredLocations) {
        // Hide all markers first
        Object.keys(cafeMarkers).forEach(locationId => {
          map.removeLayer(cafeMarkers[locationId]);
        });
        
        // Show only filtered markers
        const markersToShow = [];
        filteredLocations.forEach(location => {
          const marker = cafeMarkers[location.id];
          if (marker) {
            map.addLayer(marker);
            markersToShow.push(marker);
          }
        });
        
        // Fit map to show filtered results
        if (markersToShow.length > 0) {
          const group = L.featureGroup(markersToShow);
          group.addLayer(userMarker);
          map.fitBounds(group.getBounds().pad(0.2));
        }
      }
      
      // Update location cards with current data
      function updateLocationCards() {
        Object.keys(locations).forEach(locationId => {
          const location = locations[locationId];
          const card = document.querySelector(`[data-location="${locationId}"]`);
          if (card) {
            // Update distance in the card
            const distanceElement = card.querySelector('.text-end small');
            if (distanceElement) {
              distanceElement.textContent = location.distance;
            }
          }
        });
      }
      
      // Select a location
      function selectLocation(locationId) {
        selectedLocationId = locationId;
        const location = locations[locationId];
        
        // Update UI selection states
        document.querySelectorAll('.location-card').forEach(card => {
          card.classList.remove('selected');
        });
        const selectedCard = document.querySelector(`[data-location="${locationId}"]`);
        if (selectedCard) {
          selectedCard.classList.add('selected');
        }
        
        // Update map markers - reset all to brown first
        Object.keys(cafeMarkers).forEach(id => {
          const marker = cafeMarkers[id];
          if (marker.originalIcon) {
            marker.setIcon(marker.originalIcon);
          }
        });
        
        // Set selected marker to blue
        selectedMarker = cafeMarkers[locationId];
        if (selectedMarker) {
          // Create bigger icon for selected marker
          const selectedIcon = L.divIcon({
            className: 'cafe-marker-selected',
            html: 'â˜•',
            iconSize: [40, 40],
            iconAnchor: [20, 20]
          });
          selectedMarker.setIcon(selectedIcon);
        }
        
        // Populate location details
        document.getElementById('selectedLocationName').textContent = location.name;
        document.getElementById('selectedLocationAddress').textContent = location.address;
        document.getElementById('selectedDistance').textContent = location.distance;
        
        // Update wait time with color coding
        const waitTimeElement = document.getElementById('selectedWaitTime');
        waitTimeElement.textContent = location.waitTime;
        
        if (location.waitTimeValue > 5) {
          waitTimeElement.className = 'status-warning';
        } else {
          waitTimeElement.className = 'status-good';
        }
        
        // Show warnings
        showWarnings(location);
        
        // Show location confirmation section
        document.getElementById('locationConfirmation').style.display = 'block';
        
        // Reset service selection
        selectedService = null;
        document.querySelectorAll('.service-option').forEach(option => {
          option.classList.remove('selected');
        });
        document.getElementById('confirmLocationBtn').classList.remove('visible');
      }
      
      // Show warnings for selected location
      function showWarnings(location) {
        const warningsSection = document.getElementById('warningsSection');
        warningsSection.innerHTML = '';
        
        const warnings = [];
        
        // Check for out of stock items
        if (location.outOfStock.length > 0) {
          warnings.push(`Some items may be unavailable: ${location.outOfStock.join(', ')}`);
        }
        
        // Check for long wait times
        if (location.waitTimeValue > 5) {
          warnings.push(`Wait time exceeds 5 minutes (${location.waitTime})`);
        }
        
        // Add other warnings
        warnings.push(...location.otherWarnings);
        
        // Display warnings
        if (warnings.length > 0) {
          warnings.forEach(warning => {
            const warningDiv = document.createElement('div');
            warningDiv.className = 'alert-warning-custom';
            warningDiv.innerHTML = `
              <div class="d-flex align-items-center">
                <span class="me-2">Warning: </span>
                <span>${warning}</span>
              </div>
            `;
            warningsSection.appendChild(warningDiv);
          });
        }
      }
      
      // Select service type
      function selectService(serviceType) {
        selectedService = serviceType;
        
        // Update UI selection
        document.querySelectorAll('.service-option').forEach(option => {
          option.classList.remove('selected');
        });
        document.querySelector(`[data-service="${serviceType}"]`).classList.add('selected');
        
        // Enable confirmation button
        document.getElementById('confirmLocationBtn').classList.add('visible');
      }
      
      // Get directions to location
      function getDirections() {
        if (selectedLocationId) {
          const location = locations[selectedLocationId];
          // Open Google Maps with directions from user location to selected cafe
          const googleMapsUrl = `https://www.google.com/maps/dir/${userLocation.lat},${userLocation.lng}/${location.lat},${location.lng}`;
          window.open(googleMapsUrl, '_blank');
        }
      }
      
      // Change location (go back to search)
      function changeLocation() {
        document.getElementById('locationConfirmation').style.display = 'none';
        selectedLocationId = null;
        selectedService = null;
        
        // Reset selections
        document.querySelectorAll('.location-card').forEach(card => {
          card.classList.remove('selected');
        });
        
        // Reset map marker selection - set all back to brown
        Object.keys(cafeMarkers).forEach(id => {
          const marker = cafeMarkers[id];
          if (marker.originalIcon) {
            marker.setIcon(marker.originalIcon);
          }
        });
        selectedMarker = null;
        
        // Reset map view to show all locations
        const group = L.featureGroup(Object.values(cafeMarkers));
        group.addLayer(userMarker);
        map.fitBounds(group.getBounds().pad(0.1));
      }
      
      // Confirm location and service selection
      function confirmLocation() {
        if (!selectedLocationId || !selectedService) {
          return;
        }
        
        const location = locations[selectedLocationId];
        
        // Update modal content
        document.getElementById('modalLocationName').textContent = location.name;
        document.getElementById('modalServiceType').textContent = 
          selectedService.charAt(0).toUpperCase() + selectedService.slice(1).replace('-', ' ');
        document.getElementById('modalWaitTime').textContent = location.waitTime;
        
        // Show confirmation modal
        const modal = new bootstrap.Modal(document.getElementById('confirmationModal'));
        modal.show();
      }
      
      // Proceed to menu
      function proceedToMenu() {
        // In a real implementation, this would redirect to the menu page
        // For now, we'll redirect to the menu page in the dropdowns folder
        window.location.href = '../menu/menu.html';
      }
      
      // Show all locations (reset search)
      function showAllLocations() {
        // Clear search input
        document.getElementById('locationSearch').value = '';
        
        // Update distances
        updateDistances();
        
        // Show all locations
        document.getElementById('noResults').style.display = 'none';
        document.getElementById('searchResults').style.display = 'block';
        
        // Display all locations
        const allLocations = Object.keys(locations).map(id => ({
          id: id,
          ...locations[id]
        }));
        
        displayFilteredResults(allLocations, 'all locations');
        
        // Show all markers on map
        Object.keys(cafeMarkers).forEach(locationId => {
          if (!map.hasLayer(cafeMarkers[locationId])) {
            map.addLayer(cafeMarkers[locationId]);
          }
        });
        
        // Fit map to show all locations
        const group = L.featureGroup(Object.values(cafeMarkers));
        group.addLayer(userMarker);
        map.fitBounds(group.getBounds().pad(0.1));
      }
      
      // Allow Enter key to trigger search
      document.getElementById('locationSearch').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          searchLocations();
        }
      });
    </script>
  </body>
</html>
